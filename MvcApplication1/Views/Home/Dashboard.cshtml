@{
    ViewBag.Title = "Select2Example";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<script src="~/Scripts/jquery-1.10.2.js"></script>
<link href="~/Content/css/select2.css" rel="stylesheet" />

<script src="~/Content/Scripts/Select2.js"></script>

<div class="slider fullscreen">
    <div class="features-inner">
        <div class="row feature-tab" style="margin-left:247px;">
            <div class="col s12 m4">
                <div class="card">
                    <a href="/home/firstaid">
                        <div class="card-content">
                            <span class="card-title activator grey-text text-darken-4"><i class="fa fa-medkit"></i> First AID</span>

                        </div>
                    </a>
                </div>
            </div>

            <div class="col s12 m4">
                <div class="card">
                    <a href="/home/dashboard">
                        <div class="card-content card-selected">
                            <span class="card-title activator white-text"><i class="fa fa-tachometer"></i> Emergency Help</span>

                        </div>
                    </a>
                </div>
            </div>

            <div class="col s12 m4">
                <div class="card">
                    <a href="/home/healthhistory">
                        <div class="card-content">
                            <span class="card-title activator grey-text text-darken-4"><i class="fa fa-user-md"></i> Health History</span>

                        </div>
                    </a>
                </div>
            </div>
        </div>

        <div class="main-container">
            <div class="row">
                <div class="col s12 m3" style="margin-left:247px;">
                    <ul id="nav-mobile" class="side-nav fixed">
                        <li class="logo">
                            <a href="/home/default">
                                <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                                     viewBox="0 0 250 89.9" style="enable-background:new 0 0 250 89.9;" xml:space="preserve">
                                <style type="text/css">
                                    .st0 {
                                        fill: #8CC63F;
                                    }

                                    .st1 {
                                        fill: #EA4224;
                                    }

                                    .st2 {
                                        font-family: 'DilleniaUPC';
                                    }

                                    .st3 {
                                        font-size: 29.6383px;
                                    }

                                    .st4 {
                                        fill: #8CC640;
                                    }

                                    .st5 {
                                        font-family: 'DilleniaUPCBold';
                                    }
</style>
                                <path class="st0" d="M41.3,36c0,0,10.1-10.6,18.3,2.8c2.8,4.7,4.5,10.3-3.5,21.5l-8.2,8.9l0,0l-6.6-6.6c0,0,7.1-12.3,8-14.5
                                C50.7,44.8,53.1,33.1,41.3,36z" />
                                <path class="st1" d="M17.2,5.9c0,0-9,13.7,3.1,38.4c0,0,6.7,16,29.4,32.4c0,0,6.2,3.2,0-6c0,0-14.1-12.5-12.3-20.7
                                c0,0-0.6-12.1,17.8-28.5c0,0,4.5-4.8-1.8-0.8c0,0-10.5,9.8-21.4,9.8C31.9,30.6,20.5,31.1,17.2,5.9z" />
                                <circle class="st0" cx="32.2" cy="19.8" r="7.8" />
                                <path class="st0" d="M29.6,33.6C28.9,32.4,10.3,28,7.6,44c-0.7,4.1-2,9,12.2,25.8c0,0,12.7,13.1,15,14.5l10.3-11.1
                                c0,0-14.9-14.9-18.8-20.6C23.5,48.6,19.3,38.5,29.6,33.6z" />
                                <text transform="matrix(1 0 0 1 69.2456 56.7384)"><tspan x="0" y="0" class="st0 st2 st3">Healthy</tspan><tspan x="63.1" y="0" class="st2 st3"> </tspan><tspan x="69.7" y="0" class="st1 st4 st3">INDIA</tspan></text>
                               </svg>
                            </a>

                        </li>
                    </ul>
                </div>

                <div class="container">
                    <div class="row">
                        <div class="form-container">
                            <div class="col s12 login-screen">
                                <form class="col s12">
                                    <div id="select2Wrapper" style="height:10px;">
                                        <select id="e1" style="width:300px">
                                            <option>Select your state</option>
                                        </select>
                                        <label>Materialize Select</label>
                                        <div id=&quote;selecteddata" />
                                    </div>

                                    <div id="citieslist" class="hospital-list">

                                    </div>
                                </form>
                            </div>


                        </div>
                    </div>
                </div>


            </div>
        </div>
    </div>

</div>

</div>

<script>
    var StateHealthData, UniuqeStates, HospitalDataDic;

    $(document).ready(function () {
        initSelect2Data();
    })

    function initSelect2Data() {
        $.ajax({
            type: "GET",
            url: 'https://data.gov.in/node/95533/datastore/export/json',
            dataType: "json",
            traditional: true,
            success: function (response) {
                StateHealthData = response.data;
                displaySelect2Data(response.data);
            }
        });
    }

    function displaySelect2Data(stateList) {
        var stateNames = [];
        $.each(stateList, function (i, state) {
            if ($.inArray($.trim(state[0]) === -1))
                stateNames.push(state[0]);
        });

        UniuqeStates = $.unique(stateNames);

        $.each(UniuqeStates, function (i, state) {
            $('#e1').append($('<option>', {
                value: i,
                text: state
            }));
        });
    }

    $("#e1").select2(
{
    placeholder: "Select state",
}
).on("select2-selected", function (evt) {
    displayAvailableHospital(evt.choice.text);
});

    function displayAvailableHospital(stateName) {
        if (HospitalDataDic == null || HospitalDataDic == undefined) {

            var postData = { inputData: JSON.stringify({ HealthData: StateHealthData, SelectedState: stateName }), totalStates: JSON.stringify(UniuqeStates) };
            $.ajax({
                type: "POST",
                url: '/ghls',
                data: postData,
                dataType: "json",
                traditional: true,
                success: function (response) {
                    HospitalDataDic = response.HospitalDataDic;
                    //displaySelect2Data(response.data);
                }
            });
        }
        if (HospitalDataDic != undefined && HospitalDataDic != null && stateName != undefined && stateName != null) {
            $.each(HospitalDataDic[stateName], function (index, value) {
                arr.push('<li>' + value + '</li>');
            });
            var listResult = "<ul id='city' style='list-style: none;margin: 0;padding: 0;'>" + arr.join('') + "</ul>";
            return listResult;
        }
        else {
            $("#city").hide();
            var listResult = "<ul style='list-style: none;margin: 0;padding: 0;'>No result found</ul>";
            return listResult;
        }
        //$("#selectedData").text("Nearest available medical facilities :  " + HospitalDataDic[stateName]);
    }


</script>
